import{r as i,j as e,H as ae}from"./app-D3djMi1z.js";import{A as ne}from"./AuthenticatedLayout-DZO5WDYE.js";import{T as le,a as te,b as S,M as re}from"./tabs-P59X8-LS.js";import{I as ie}from"./popover-By6pyw1h.js";import{B as y}from"./button-2QLFVnxw.js";import{B as z}from"./badge-BJk-76aQ.js";import{S as C,a as D,b as I,c as P,d as t}from"./select-Buwljau9.js";import{D as ce,a as oe,b as de,c as b}from"./dropdown-menu-D93AjIhL.js";import{P as xe,a as he,b as h,c as me,d as T,e as U,f as pe}from"./pagination-BTOym5gj.js";import{T as _,a as ue,b as f,c as m,d as V,e as r}from"./table-hG5a-Cqx.js";import{D as je}from"./download-C2vZZrT9.js";import{C as ge,T as B}from"./use-controlled-state-_609xuTv.js";import{S as fe}from"./search-CTP6CmfA.js";import{A as Ne}from"./award-bUMx7ykn.js";import"./ApplicationLogo-DR5Al8_M.js";import"./transition-DD3lfjsW.js";import"./UserAvatar-DMxWifGL.js";import"./utils-DxrgW60L.js";import"./proxy-D9ZHkyEz.js";import"./index-Bkkt4zum.js";import"./createLucideIcon-CuKIg8Rh.js";import"./log-out-DURLpOVm.js";import"./index-DvhQXPbi.js";import"./floating-ui.utils.dom-Ds-VJJzb.js";import"./check-BDWMKofN.js";function Ke({auth:$}){const d=$?.user?.roles?.some(s=>s.name==="admin")||!1,[M,F]=i.useState([]),[l,u]=i.useState({pageIndex:0,pageSize:10}),[v,L]=i.useState(""),[R,W]=i.useState(""),[c,H]=i.useState("weekly"),[p,K]=i.useState("8"),[j,Y]=i.useState("12"),[x,O]=i.useState(null),[o,q]=i.useState(1),[k,G]=i.useState(0),[J,A]=i.useState(!1),Q=s=>{switch(s){case 1:return e.jsx(B,{className:"h-5 w-5 text-yellow-500"});case 2:return e.jsx(re,{className:"h-5 w-5 text-gray-400"});case 3:return e.jsx(Ne,{className:"h-5 w-5 text-amber-600"});default:return null}},X=s=>{switch(s){case 1:return"border-l-4 border-yellow-500";case 2:return"border-l-4 border-gray-400";case 3:return"border-l-4 border-amber-500";default:return""}};i.useEffect(()=>{Z()},[l.pageIndex,l.pageSize,v,c,p,j]);const Z=async()=>{A(!0);try{const s=new URLSearchParams({period:c,page:l.pageIndex+1,per_page:l.pageSize,search:v});c==="weekly"&&p?s.append("week",p):c==="monthly"&&j&&(s.append("month",j),s.append("year","2025"));const a=await(await fetch(`${route("shop.api.leaderboard.full")}?${s}`)).json();F(a.data||[]),q(a.last_page||1),G(a.total||0),O(a.unit_position)}catch(s){console.error("Error fetching leaderboard data:",s),F([])}finally{A(!1)}},E=()=>{L(R),u(s=>({...s,pageIndex:0}))},ee=s=>{s.key==="Enter"&&E()},se=()=>{W(""),L(""),u(s=>({...s,pageIndex:0}))},g=s=>{u(n=>({...n,pageIndex:s-1}))},N=s=>{const n=new URLSearchParams;if(n.append("period",s),s==="monthly"&&c==="monthly"){const a=new URLSearchParams(window.location.search).get("month"),w=new URLSearchParams(window.location.search).get("year");a&&w&&(n.append("month",a),n.append("year",w))}window.location.href=`${route("shop.leaderboard.full.export")}?${n.toString()}`};return e.jsxs(ne,{header:e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Entrepreneur Full Rankings"})}),children:[e.jsx(ae,{title:"Entrepreneur Full Rankings"}),e.jsx("div",{className:"pt-2 pb-8",children:e.jsx("div",{className:"mx-auto max-w-7xl",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs(le,{value:c,onValueChange:s=>{H(s),u({pageIndex:0,pageSize:10})},children:[e.jsx("div",{className:"mb-6",children:e.jsxs(te,{className:"grid w-full grid-cols-3",children:[e.jsx(S,{value:"weekly",children:"Weekly"}),e.jsx(S,{value:"monthly",children:"Monthly"}),e.jsx(S,{value:"all_time",children:"All-Time"})]})}),e.jsxs("div",{className:"mb-4",children:[c==="weekly"&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Week ",p]}),e.jsx("p",{className:"text-sm text-gray-600",children:{1:"Nov 1 - 9, 2025",2:"Nov 10 - 16, 2025",3:"Nov 17 - 23, 2025",4:"Nov 24 - 30, 2025",5:"Dec 1 - 7, 2025",6:"Dec 8 - 14, 2025",7:"Dec 15 - 21, 2025",8:"Dec 22 - 28, 2025"}[p]||"Select a week"})]}),c==="monthly"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:{11:"November 2025",12:"December 2025"}[j]||"Select a month"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Monthly Leaderboard"})]}),c==="all_time"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"All-Time Champions"}),e.jsx("p",{className:"text-sm text-gray-600",children:d?"Since the beginning of the competition":"Since November 1, 2025"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full sm:max-w-md",children:[d&&e.jsxs(ce,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:"gap-2 flex-shrink-0",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export CSV"}),e.jsx(ge,{className:"h-4 w-4"})]})}),e.jsxs(de,{align:"start",children:[e.jsx(b,{onClick:()=>N("weekly"),children:"Weekly (Full List)"}),e.jsx(b,{onClick:()=>N("monthly"),children:"Monthly (Full List)"}),e.jsx(b,{onClick:()=>N("all_time"),children:"All-Time (Full List)"}),e.jsx(b,{onClick:()=>N("all"),children:"All Periods (Full List)"})]})]}),e.jsx(ie,{placeholder:"Search by business name...",value:R,onChange:s=>W(s.target.value),onKeyPress:ee,className:"flex-1"}),e.jsxs(y,{onClick:E,className:"bg-black hover:bg-gray-800 text-white flex-shrink-0",children:[e.jsx(fe,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Search"})]}),v&&e.jsxs(y,{onClick:se,variant:"outline",className:"border-gray-300 flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:"Clear"}),e.jsx("span",{className:"sm:hidden",children:"Ã—"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end sm:justify-start",children:[c==="weekly"&&e.jsxs(C,{value:p,onValueChange:K,children:[e.jsx(D,{className:"w-[180px]",children:e.jsx(I,{placeholder:"Select Week"})}),e.jsxs(P,{children:[e.jsx(t,{value:"1",children:"Week 1 (Nov 1-9)"}),e.jsx(t,{value:"2",children:"Week 2 (Nov 10-16)"}),e.jsx(t,{value:"3",children:"Week 3 (Nov 17-23)"}),e.jsx(t,{value:"4",children:"Week 4 (Nov 24-30)"}),e.jsx(t,{value:"5",children:"Week 5 (Dec 1-7)"}),e.jsx(t,{value:"6",children:"Week 6 (Dec 8-14)"}),e.jsx(t,{value:"7",children:"Week 7 (Dec 15-21)"}),e.jsx(t,{value:"8",children:"Week 8 (Dec 22-28)"})]})]}),c==="monthly"&&e.jsxs(C,{value:j,onValueChange:Y,children:[e.jsx(D,{className:"w-[180px]",children:e.jsx(I,{placeholder:"Select Month"})}),e.jsxs(P,{children:[e.jsx(t,{value:"11",children:"November 2025"}),e.jsx(t,{value:"12",children:"December 2025"})]})]}),e.jsxs(C,{value:String(l.pageSize),onValueChange:s=>u({pageIndex:0,pageSize:parseInt(s)}),children:[e.jsx(D,{className:"w-[120px]",children:e.jsx(I,{})}),e.jsxs(P,{children:[e.jsx(t,{value:"10",children:"10 rows"}),e.jsx(t,{value:"20",children:"20 rows"}),e.jsx(t,{value:"30",children:"30 rows"}),e.jsx(t,{value:"50",children:"50 rows"}),e.jsx(t,{value:"100",children:"100 rows"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx(_,{className:"table-fixed w-full",children:e.jsx(ue,{className:"bg-gray-50",children:e.jsxs(f,{children:[e.jsx(m,{className:"w-24 px-6",children:"Rank"}),e.jsx(m,{className:"px-4",children:"Business Unit"}),e.jsx(m,{className:"w-40 px-4 text-center",children:"Type"}),d&&e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-32 px-4",children:"Manager"}),e.jsx(m,{className:"w-32 px-4 text-center",children:"Members"})]}),e.jsx(m,{className:"w-36 text-right px-4",children:"Transactions"}),e.jsx(m,{className:"w-36 text-right px-6",children:"Total Amount"})]})})}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"600px"},children:e.jsx(_,{className:"table-fixed w-full",children:e.jsx(V,{children:J?e.jsx(f,{children:e.jsx(r,{colSpan:d?7:5,className:"h-24 text-center",children:"Loading..."})}):M.length===0?e.jsx(f,{children:e.jsx(r,{colSpan:d?7:5,className:"h-24 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-gray-500",children:[e.jsx(B,{className:"h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No rankings found"})]})})}):M.map((s,n)=>e.jsxs(f,{className:`${X(s.rank)} ${n%2===0?"":"bg-gray-50/50"} hover:bg-gray-100/50 transition-colors`,children:[e.jsx(r,{className:"w-24 font-bold px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[Q(s.rank),e.jsxs("span",{className:s.rank<=3?"text-lg":"",children:["#",s.rank]})]})}),e.jsx(r,{className:"font-medium px-4",children:s.entrepreneur_unit?.business_name}),e.jsx(r,{className:"w-40 text-center px-4",children:s.entrepreneur_unit?.business_location==="physical"?e.jsx(z,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:"Physical"}):e.jsx(z,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Online"})}),d&&e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-32 px-4 text-sm truncate",children:s.entrepreneur_unit?.manager?.name||"Unknown"}),e.jsx(r,{className:"w-32 px-4 text-center text-sm",children:s.entrepreneur_unit?.team_members_count||0})]}),e.jsx(r,{className:`w-36 text-right font-bold px-4 ${s.rank<=3?"text-xl":"text-lg"}`,children:e.jsx("span",{className:s.rank===1?"text-yellow-600":s.rank===2?"text-gray-600":s.rank===3?"text-amber-600":"",children:s.transaction_count})}),e.jsxs(r,{className:"w-36 text-right px-6 font-medium text-gray-600",children:["RM ",s.total_amount?parseFloat(s.total_amount).toFixed(2):"0.00"]})]},s.unit_id))})})}),x&&!d&&e.jsx("div",{className:"bg-indigo-50 border-t-2 border-indigo-300",children:e.jsx(_,{className:"table-fixed w-full",children:e.jsx(V,{children:e.jsxs(f,{children:[e.jsxs(r,{className:"w-24 font-bold px-6",children:["#",x.rank!==null&&x.rank!==void 0?x.rank:"-"]}),e.jsx(r,{className:"font-bold px-4",colSpan:2,children:"Your Business Unit"}),e.jsx(r,{className:"w-36 text-right font-bold text-lg px-4",children:x.transaction_count||0}),e.jsxs(r,{className:"w-36 text-right font-medium text-gray-700 px-6",children:["RM ",x.total_amount?parseFloat(x.total_amount).toFixed(2):"0.00"]})]})})})})]}),k>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"text-sm text-gray-500 w-full sm:w-auto text-center sm:text-left",children:["Showing ",l.pageIndex*l.pageSize+1," to ",Math.min((l.pageIndex+1)*l.pageSize,k)," of ",k," results"]}),o>1&&e.jsx(xe,{className:"mx-0 w-full sm:w-auto justify-center sm:justify-end",children:e.jsxs(he,{children:[e.jsx(h,{children:e.jsx(me,{href:"#",onClick:s=>{s.preventDefault(),l.pageIndex>0&&g(l.pageIndex)},className:l.pageIndex===0?"pointer-events-none opacity-50":"cursor-pointer"})}),(()=>{const s=[],n=l.pageIndex+1;o>0&&s.push(e.jsx(h,{children:e.jsx(T,{href:"#",onClick:a=>{a.preventDefault(),g(1)},isActive:n===1,children:1})},1)),n>3&&s.push(e.jsx(h,{children:e.jsx(U,{})},"ellipsis-1"));for(let a=Math.max(2,n-1);a<=Math.min(o-1,n+1);a++)s.push(e.jsx(h,{children:e.jsx(T,{href:"#",onClick:w=>{w.preventDefault(),g(a)},isActive:n===a,children:a})},a));return n<o-2&&s.push(e.jsx(h,{children:e.jsx(U,{})},"ellipsis-2")),o>1&&s.push(e.jsx(h,{children:e.jsx(T,{href:"#",onClick:a=>{a.preventDefault(),g(o)},isActive:n===o,children:o})},o)),s})(),e.jsx(h,{children:e.jsx(pe,{href:"#",onClick:s=>{s.preventDefault(),l.pageIndex<o-1&&g(l.pageIndex+2)},className:l.pageIndex>=o-1?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]})]})})})})]})}export{Ke as default};
