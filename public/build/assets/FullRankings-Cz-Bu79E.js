import{r as c,j as e,H as ne}from"./app-BJdaTNqI.js";import{A as ie}from"./AuthenticatedLayout-B1UKtRnA.js";import{T as ce,a as oe,b as k,M as de}from"./tabs-Dq4BGMCT.js";import{I as xe}from"./popover-BWURJgjT.js";import{B as S}from"./button-DF_YCOm-.js";import{B as me}from"./badge-YN655oJx.js";import{S as P,a as I,b as M,c as T,d as i}from"./select-DgENZMGv.js";import{D as he,a as pe,b as ue,c as y}from"./dropdown-menu-BjAiq1Pt.js";import{P as je,a as ge,b as h,c as fe,d as _,e as B,f as Ne}from"./pagination-Ds5_Mi1g.js";import{U as H}from"./UserAvatar-7oWcXKi_.js";import{T as A,a as we,b as v,c as x,d as Y,e as o}from"./table-B8dgzD2h.js";import{f as j,D as ye}from"./date-range-picker-nnCMVxoS.js";import{D as g}from"./download-BUORsfsd.js";import{C as ve,T as U}from"./use-controlled-state-DkZSzQIY.js";import{S as be}from"./search-Ck0kxmk7.js";import{A as ke}from"./award-BWDVGNH4.js";import"./ApplicationLogo-DgQIk4Ie.js";import"./transition-CDRgjYIX.js";import"./utils-DxrgW60L.js";import"./proxy-CRcFvVbD.js";import"./index-DUWZ4qQK.js";import"./createLucideIcon-B79Mf7u7.js";import"./log-out-CTNyGy52.js";import"./index-BvgExRt0.js";import"./floating-ui.utils.dom-Ds-VJJzb.js";import"./check-D1la7OOH.js";import"./en-US-CKZa3QIe.js";import"./calendar-D85PYRDC.js";function ss({auth:L}){const m=L?.user?.roles?.some(s=>s.name==="admin")||!1,[R,F]=c.useState([]),[r,p]=c.useState({pageIndex:0,pageSize:10}),[C,W]=c.useState(""),[z,V]=c.useState(""),[t,K]=c.useState("weekly"),[b,q]=c.useState("8"),[u,G]=c.useState("12"),[a,J]=c.useState({from:void 0,to:void 0}),[f,O]=c.useState(null),[d,Q]=c.useState(1),[D,X]=c.useState(0),[Se,Ce]=c.useState({}),[Z,$]=c.useState(!1),N=s=>{const l={period:s};if(s==="custom")if(a?.from&&a?.to)l.start_date=j(a.from,"yyyy-MM-dd"),l.end_date=j(a.to,"yyyy-MM-dd");else{alert("Please select a date range first.");return}else s==="monthly"&&t==="monthly"&&u&&(l.month=u,l.year="2025");window.location.href=route("leaderboard.export",l)},ee=s=>{switch(s){case 1:return e.jsx(U,{className:"h-5 w-5 text-yellow-500"});case 2:return e.jsx(de,{className:"h-5 w-5 text-gray-400"});case 3:return e.jsx(ke,{className:"h-5 w-5 text-amber-600"});default:return null}},se=s=>{switch(s){case 1:return"border-l-4 border-yellow-500";case 2:return"border-l-4 border-gray-400";case 3:return"border-l-4 border-amber-500";default:return""}};c.useEffect(()=>{(t!=="custom"||a?.from&&a?.to)&&ae()},[r.pageIndex,r.pageSize,C,t,b,u,a]);const ae=async()=>{$(!0);try{const s=new URLSearchParams({period:t,page:r.pageIndex+1,per_page:r.pageSize,search:C});t==="weekly"&&b?s.append("week",b):t==="monthly"&&u?(s.append("month",u),s.append("year","2025")):t==="custom"&&a?.from&&a?.to&&(s.append("start_date",j(a.from,"yyyy-MM-dd")),s.append("end_date",j(a.to,"yyyy-MM-dd")));const n=await(await fetch(`/api/leaderboard/full?${s}`)).json();F(n.data||[]),Q(n.last_page||1),X(n.total||0),O(n.user_position)}catch(s){console.error("Error fetching leaderboard data:",s),F([])}finally{$(!1)}},E=()=>{W(z),p(s=>({...s,pageIndex:0}))},le=s=>{s.key==="Enter"&&E()},re=()=>{V(""),W(""),p(s=>({...s,pageIndex:0}))},w=s=>{p(l=>({...l,pageIndex:s-1}))};return e.jsxs(ie,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Full Rankings"}),children:[e.jsx(ne,{title:"Full Rankings"}),e.jsx("div",{className:"pt-2 pb-8",children:e.jsx("div",{className:"mx-auto max-w-7xl",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs(ce,{value:t,onValueChange:s=>{K(s),p({pageIndex:0,pageSize:10})},children:[e.jsx("div",{className:"mb-6",children:e.jsxs(oe,{className:`grid w-full ${m?"grid-cols-4":"grid-cols-3"}`,children:[e.jsx(k,{value:"weekly",children:"Weekly"}),e.jsx(k,{value:"monthly",children:"Monthly"}),e.jsx(k,{value:"all_time",children:"All-Time"}),m&&e.jsx(k,{value:"custom",children:"Custom"})]})}),e.jsxs("div",{className:"mb-4",children:[t==="weekly"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"This Week"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-MY",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),t==="monthly"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"This Month"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-MY",{month:"long",year:"numeric"})})]}),t==="all_time"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"All-Time Champions"}),e.jsx("p",{className:"text-sm text-gray-600",children:m?"Since the beginning of the competition":"Since November 1, 2025"})]}),t==="custom"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Custom Range"}),e.jsx("p",{className:"text-sm text-gray-600",children:a?.from&&a?.to?`${j(a.from,"PPP")} - ${j(a.to,"PPP")}`:"Select a date range"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full sm:max-w-md",children:[m&&e.jsxs(he,{children:[e.jsx(pe,{asChild:!0,children:e.jsxs(S,{variant:"outline",size:"sm",className:"gap-2 mr-2 flex-shrink-0",children:[e.jsx(g,{className:"h-4 w-4"}),"Export CSV",e.jsx(ve,{className:"h-4 w-4"})]})}),e.jsxs(ue,{align:"start",children:[e.jsxs(y,{onClick:()=>N("weekly"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"Weekly (Full List)"]}),e.jsxs(y,{onClick:()=>N("monthly"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"Monthly (Full List)"]}),e.jsxs(y,{onClick:()=>N("all_time"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"All-Time (Full List)"]}),e.jsxs(y,{onClick:()=>N("all"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"All Periods (Full List)"]}),t==="custom"&&e.jsxs(y,{onClick:()=>N("custom"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"Custom Range (Full List)"]})]})]}),e.jsx(xe,{placeholder:"Search by name...",value:z,onChange:s=>V(s.target.value),onKeyPress:le,className:"flex-1"}),e.jsxs(S,{onClick:E,className:"bg-black hover:bg-gray-800 text-white flex-shrink-0",children:[e.jsx(be,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Search"})]}),C&&e.jsxs(S,{onClick:re,variant:"outline",className:"border-gray-300 flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:"Clear"}),e.jsx("span",{className:"sm:hidden",children:"Ã—"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end sm:justify-start",children:[t==="weekly"&&e.jsxs(P,{value:b,onValueChange:q,children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(M,{placeholder:"Select Week"})}),e.jsxs(T,{children:[e.jsx(i,{value:"1",children:"Week 1 (Nov 1-9)"}),e.jsx(i,{value:"2",children:"Week 2 (Nov 10-16)"}),e.jsx(i,{value:"3",children:"Week 3 (Nov 17-23)"}),e.jsx(i,{value:"4",children:"Week 4 (Nov 24-30)"}),e.jsx(i,{value:"5",children:"Week 5 (Dec 1-7)"}),e.jsx(i,{value:"6",children:"Week 6 (Dec 8-14)"}),e.jsx(i,{value:"7",children:"Week 7 (Dec 15-21)"}),e.jsx(i,{value:"8",children:"Week 8 (Dec 22-28)"})]})]}),t==="monthly"&&e.jsxs(P,{value:u,onValueChange:G,children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(M,{placeholder:"Select Month"})}),e.jsxs(T,{children:[e.jsx(i,{value:"11",children:"November 2025"}),e.jsx(i,{value:"12",children:"December 2025"})]})]}),t==="custom"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{value:a,onChange:J}),e.jsx(S,{onClick:()=>p({pageIndex:0,pageSize:10}),disabled:!a?.from||!a?.to,children:"Apply"})]}),e.jsxs(P,{value:String(r.pageSize),onValueChange:s=>p({pageIndex:0,pageSize:parseInt(s)}),children:[e.jsx(I,{className:"w-[120px]",children:e.jsx(M,{})}),e.jsxs(T,{children:[e.jsx(i,{value:"10",children:"10 rows"}),e.jsx(i,{value:"20",children:"20 rows"}),e.jsx(i,{value:"30",children:"30 rows"}),e.jsx(i,{value:"50",children:"50 rows"}),e.jsx(i,{value:"100",children:"100 rows"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx(A,{className:"table-fixed w-full",children:e.jsx(we,{className:"bg-gray-50",children:e.jsxs(v,{children:[e.jsx(x,{className:"w-24 px-6",children:"Rank"}),e.jsx(x,{className:"w-20 px-4",children:"Avatar"}),e.jsx(x,{className:"px-4",children:"Name"}),m&&e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-32 px-4",children:"Matric No"}),e.jsx(x,{className:"w-36 px-4",children:"Phone Number"}),e.jsx(x,{className:"w-24 px-4",children:"Faculty"}),e.jsx(x,{className:"w-20 px-4",children:"Year"})]}),e.jsx(x,{className:"w-36 text-right px-6",children:"Transactions"})]})})}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"600px"},children:e.jsx(A,{className:"table-fixed w-full",children:e.jsx(Y,{children:Z?e.jsx(v,{children:e.jsx(o,{colSpan:4,className:"h-24 text-center",children:"Loading..."})}):R.length===0?e.jsx(v,{children:e.jsx(o,{colSpan:4,className:"h-24 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-gray-500",children:[e.jsx(U,{className:"h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No rankings found"})]})})}):R.map((s,l)=>e.jsxs(v,{className:`${se(s.rank)} ${l%2===0?"":"bg-gray-50/50"} hover:bg-gray-100/50 transition-colors`,children:[e.jsx(o,{className:"w-24 font-bold px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[ee(s.rank),e.jsxs("span",{className:s.rank<=3?"text-lg":"",children:["#",s.rank]})]})}),e.jsx(o,{className:"w-20 px-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(H,{user:s.user,size:"sm"})})}),e.jsx(o,{className:"font-medium px-4",children:s.user?.name}),m&&e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-32 px-4",children:s.user?.matric_no||"N/A"}),e.jsx(o,{className:"w-36 px-4",children:s.user?.phone_number||"N/A"}),e.jsx(o,{className:"w-24 px-4",children:s.user?.faculty?e.jsx(me,{variant:"outline",children:s.user.faculty.short_name}):e.jsx("span",{className:"text-gray-400",children:"N/A"})}),e.jsx(o,{className:"w-20 px-4",children:s.user?.year_of_study?`Year ${s.user.year_of_study}`:"N/A"})]}),e.jsx(o,{className:`w-36 text-right font-bold px-6 ${s.rank<=3?"text-xl":"text-lg"}`,children:e.jsx("span",{className:s.rank===1?"text-yellow-600":s.rank===2?"text-gray-600":s.rank===3?"text-amber-600":"",children:s.transaction_count})})]},s.user_id))})})}),f&&!m&&e.jsx("div",{className:"bg-gray-100 border-t-2 border-gray-300",children:e.jsx(A,{className:"table-fixed w-full",children:e.jsx(Y,{children:e.jsxs(v,{children:[e.jsxs(o,{className:"w-24 font-bold px-6",children:["#",f.rank!==null&&f.rank!==void 0?f.rank:"-"]}),e.jsx(o,{className:"w-20 px-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(H,{user:L.user,size:"sm"})})}),e.jsx(o,{className:"font-bold px-4",children:"You"}),e.jsx(o,{className:"w-36 text-right font-bold text-lg px-6",children:f.transaction_count||0})]})})})})]}),D>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"text-sm text-gray-500 w-full sm:w-auto text-center sm:text-left",children:["Showing ",r.pageIndex*r.pageSize+1," to ",Math.min((r.pageIndex+1)*r.pageSize,D)," of ",D," results"]}),d>1&&e.jsx(je,{className:"mx-0 w-full sm:w-auto justify-center sm:justify-end",children:e.jsxs(ge,{children:[e.jsx(h,{children:e.jsx(fe,{href:"#",onClick:s=>{s.preventDefault(),r.pageIndex>0&&w(r.pageIndex)},className:r.pageIndex===0?"pointer-events-none opacity-50":"cursor-pointer"})}),(()=>{const s=[],l=r.pageIndex+1;d>0&&s.push(e.jsx(h,{children:e.jsx(_,{href:"#",onClick:n=>{n.preventDefault(),w(1)},isActive:l===1,className:"cursor-pointer",children:"1"})},1)),l>3&&s.push(e.jsx(h,{children:e.jsx(B,{})},"ellipsis-1"));for(let n=Math.max(2,l-1);n<=Math.min(d-1,l+1);n++)s.push(e.jsx(h,{children:e.jsx(_,{href:"#",onClick:te=>{te.preventDefault(),w(n)},isActive:l===n,className:"cursor-pointer",children:n})},n));return l<d-2&&s.push(e.jsx(h,{children:e.jsx(B,{})},"ellipsis-2")),d>1&&s.push(e.jsx(h,{children:e.jsx(_,{href:"#",onClick:n=>{n.preventDefault(),w(d)},isActive:l===d,className:"cursor-pointer",children:d})},d)),s})(),e.jsx(h,{children:e.jsx(Ne,{href:"#",onClick:s=>{s.preventDefault(),r.pageIndex<d-1&&w(r.pageIndex+2)},className:r.pageIndex>=d-1?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]})]})})})})]})}export{ss as default};
