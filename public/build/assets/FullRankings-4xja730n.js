import{r as i,j as e,H as J}from"./app-DiCS7Dr5.js";import{A as O}from"./AuthenticatedLayout-C78WuwR4.js";import{T as Q,a as X,b as v,M as Z}from"./tabs-CZNQzXTI.js";import{I as ee}from"./input-BSjjfyZx.js";import{B as y}from"./button-DPCdG-_J.js";import{B as se}from"./badge-Byk6qD5Q.js";import{D as ae,a as le,b as re,c as N,S as ne,d as te,e as ie,f as ce,g as p}from"./select-DX9y4aPF.js";import{P as oe,a as de,b as o,c as xe,d as k,e as L,f as me}from"./pagination-7vXdI_TK.js";import{U as F}from"./UserAvatar-VBNTlCMe.js";import{T as S,a as he,b as u,c,d as z,e as r}from"./table-4LnpLVKf.js";import{D as j}from"./download-B1xqHaRU.js";import{C as pe,T as R}from"./use-controlled-state-CorO0q_c.js";import{S as ue}from"./search-DNO-97co.js";import{A as je}from"./award-DHhdsUIf.js";import"./ApplicationLogo-C4sK9qjX.js";import"./transition-D1WSC8PC.js";import"./utils-QVnhiEkH.js";import"./proxy-eBssZYsz.js";import"./index-Do_C_Rtp.js";import"./index-Uh4Wl1jx.js";import"./createLucideIcon-Db3t3tef.js";import"./index-BleKman2.js";import"./check-DkLBEV-v.js";function Ye({auth:C}){const[I,T]=i.useState([]),[a,x]=i.useState({pageIndex:0,pageSize:10}),[w,P]=i.useState(""),[D,A]=i.useState(""),[d,V]=i.useState("all_time"),[m,E]=i.useState(null),[t,B]=i.useState(1),[b,H]=i.useState(0),[ge,fe]=i.useState({}),[Y,_]=i.useState(!1),g=C?.user?.roles?.some(s=>s.name==="admin")||!1,f=s=>{window.location.href=route("leaderboard.export",{period:s})},$=s=>{switch(s){case 1:return e.jsx(R,{className:"h-5 w-5 text-yellow-500"});case 2:return e.jsx(Z,{className:"h-5 w-5 text-gray-400"});case 3:return e.jsx(je,{className:"h-5 w-5 text-amber-600"});default:return null}},U=s=>{switch(s){case 1:return"border-l-4 border-yellow-500";case 2:return"border-l-4 border-gray-400";case 3:return"border-l-4 border-amber-500";default:return""}};i.useEffect(()=>{W()},[a.pageIndex,a.pageSize,w,d]);const W=async()=>{_(!0);try{const s=new URLSearchParams({period:d,page:a.pageIndex+1,per_page:a.pageSize,search:w}),l=await(await fetch(`/api/leaderboard/full?${s}`)).json();T(l.data||[]),B(l.last_page||1),H(l.total||0),E(l.user_position)}catch(s){console.error("Error fetching leaderboard data:",s),T([])}finally{_(!1)}},M=()=>{P(D),x(s=>({...s,pageIndex:0}))},K=s=>{s.key==="Enter"&&M()},q=()=>{A(""),P(""),x(s=>({...s,pageIndex:0}))},h=s=>{x(n=>({...n,pageIndex:s-1}))};return e.jsxs(O,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Full Rankings"}),children:[e.jsx(J,{title:"Full Rankings"}),e.jsx("div",{className:"pt-2 pb-8",children:e.jsx("div",{className:"mx-auto max-w-7xl",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs(Q,{value:d,onValueChange:s=>{V(s),x({pageIndex:0,pageSize:10})},children:[e.jsxs(X,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsx(v,{value:"weekly",children:"Weekly"}),e.jsx(v,{value:"monthly",children:"Monthly"}),e.jsx(v,{value:"all_time",children:"All-Time"})]}),e.jsxs("div",{className:"mb-4",children:[d==="weekly"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"This Week"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-MY",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),d==="monthly"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"This Month"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-MY",{month:"long",year:"numeric"})})]}),d==="all_time"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"All-Time Champions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Since the beginning of the competition"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full sm:max-w-md",children:[g&&e.jsxs(ae,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(y,{variant:"outline",size:"sm",className:"gap-2 mr-2 flex-shrink-0",children:[e.jsx(j,{className:"h-4 w-4"}),"Export CSV",e.jsx(pe,{className:"h-4 w-4"})]})}),e.jsxs(re,{align:"start",children:[e.jsxs(N,{onClick:()=>f("weekly"),children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),"Weekly (Full List)"]}),e.jsxs(N,{onClick:()=>f("monthly"),children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),"Monthly (Full List)"]}),e.jsxs(N,{onClick:()=>f("all_time"),children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),"All-Time (Full List)"]}),e.jsxs(N,{onClick:()=>f("all"),children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),"All Periods (Full List)"]})]})]}),e.jsx(ee,{placeholder:"Search by name...",value:D,onChange:s=>A(s.target.value),onKeyPress:K,className:"flex-1"}),e.jsxs(y,{onClick:M,className:"bg-black hover:bg-gray-800 text-white flex-shrink-0",children:[e.jsx(ue,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Search"})]}),w&&e.jsxs(y,{onClick:q,variant:"outline",className:"border-gray-300 flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:"Clear"}),e.jsx("span",{className:"sm:hidden",children:"Ã—"})]})]}),e.jsx("div",{className:"flex items-center gap-2 justify-end sm:justify-start",children:e.jsxs(ne,{value:String(a.pageSize),onValueChange:s=>x({pageIndex:0,pageSize:parseInt(s)}),children:[e.jsx(te,{className:"w-[120px]",children:e.jsx(ie,{})}),e.jsxs(ce,{children:[e.jsx(p,{value:"10",children:"10 rows"}),e.jsx(p,{value:"20",children:"20 rows"}),e.jsx(p,{value:"30",children:"30 rows"}),e.jsx(p,{value:"50",children:"50 rows"}),e.jsx(p,{value:"100",children:"100 rows"})]})]})})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx(S,{className:"table-fixed w-full",children:e.jsx(he,{className:"bg-gray-50",children:e.jsxs(u,{children:[e.jsx(c,{className:"w-24 px-6",children:"Rank"}),e.jsx(c,{className:"w-20 px-4",children:"Avatar"}),e.jsx(c,{className:"px-4",children:"Name"}),g&&e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-32 px-4",children:"Matric No"}),e.jsx(c,{className:"w-36 px-4",children:"Phone Number"}),e.jsx(c,{className:"w-24 px-4",children:"Faculty"}),e.jsx(c,{className:"w-20 px-4",children:"Year"})]}),e.jsx(c,{className:"w-36 text-right px-6",children:"Transactions"})]})})}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"600px"},children:e.jsx(S,{className:"table-fixed w-full",children:e.jsx(z,{children:Y?e.jsx(u,{children:e.jsx(r,{colSpan:4,className:"h-24 text-center",children:"Loading..."})}):I.length===0?e.jsx(u,{children:e.jsx(r,{colSpan:4,className:"h-24 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-gray-500",children:[e.jsx(R,{className:"h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No rankings found"})]})})}):I.map((s,n)=>e.jsxs(u,{className:`${U(s.rank)} ${n%2===0?"":"bg-gray-50/50"} hover:bg-gray-100/50 transition-colors`,children:[e.jsx(r,{className:"w-24 font-bold px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[$(s.rank),e.jsxs("span",{className:s.rank<=3?"text-lg":"",children:["#",s.rank]})]})}),e.jsx(r,{className:"w-20 px-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(F,{user:s.user,size:"sm"})})}),e.jsx(r,{className:"font-medium px-4",children:s.user?.name}),g&&e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-32 px-4",children:s.user?.matric_no||"N/A"}),e.jsx(r,{className:"w-36 px-4",children:s.user?.phone_number||"N/A"}),e.jsx(r,{className:"w-24 px-4",children:s.user?.faculty?e.jsx(se,{variant:"outline",children:s.user.faculty.short_name}):e.jsx("span",{className:"text-gray-400",children:"N/A"})}),e.jsx(r,{className:"w-20 px-4",children:s.user?.year_of_study?`Year ${s.user.year_of_study}`:"N/A"})]}),e.jsx(r,{className:`w-36 text-right font-bold px-6 ${s.rank<=3?"text-xl":"text-lg"}`,children:e.jsx("span",{className:s.rank===1?"text-yellow-600":s.rank===2?"text-gray-600":s.rank===3?"text-amber-600":"",children:s.transaction_count})})]},s.user_id))})})}),m&&!g&&e.jsx("div",{className:"bg-gray-100 border-t-2 border-gray-300",children:e.jsx(S,{className:"table-fixed w-full",children:e.jsx(z,{children:e.jsxs(u,{children:[e.jsxs(r,{className:"w-24 font-bold px-6",children:["#",m.rank!==null&&m.rank!==void 0?m.rank:"-"]}),e.jsx(r,{className:"w-20 px-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(F,{user:C.user,size:"sm"})})}),e.jsx(r,{className:"font-bold px-4",children:"You"}),e.jsx(r,{className:"w-36 text-right font-bold text-lg px-6",children:m.transaction_count||0})]})})})})]}),b>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"text-sm text-gray-500 w-full sm:w-auto text-center sm:text-left",children:["Showing ",a.pageIndex*a.pageSize+1," to ",Math.min((a.pageIndex+1)*a.pageSize,b)," of ",b," results"]}),t>1&&e.jsx(oe,{className:"mx-0 w-full sm:w-auto justify-center sm:justify-end",children:e.jsxs(de,{children:[e.jsx(o,{children:e.jsx(xe,{href:"#",onClick:s=>{s.preventDefault(),a.pageIndex>0&&h(a.pageIndex)},className:a.pageIndex===0?"pointer-events-none opacity-50":"cursor-pointer"})}),(()=>{const s=[],n=a.pageIndex+1;t>0&&s.push(e.jsx(o,{children:e.jsx(k,{href:"#",onClick:l=>{l.preventDefault(),h(1)},isActive:n===1,className:"cursor-pointer",children:"1"})},1)),n>3&&s.push(e.jsx(o,{children:e.jsx(L,{})},"ellipsis-1"));for(let l=Math.max(2,n-1);l<=Math.min(t-1,n+1);l++)s.push(e.jsx(o,{children:e.jsx(k,{href:"#",onClick:G=>{G.preventDefault(),h(l)},isActive:n===l,className:"cursor-pointer",children:l})},l));return n<t-2&&s.push(e.jsx(o,{children:e.jsx(L,{})},"ellipsis-2")),t>1&&s.push(e.jsx(o,{children:e.jsx(k,{href:"#",onClick:l=>{l.preventDefault(),h(t)},isActive:n===t,className:"cursor-pointer",children:t})},t)),s})(),e.jsx(o,{children:e.jsx(me,{href:"#",onClick:s=>{s.preventDefault(),a.pageIndex<t-1&&h(a.pageIndex+2)},className:a.pageIndex>=t-1?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]})]})})})})]})}export{Ye as default};
