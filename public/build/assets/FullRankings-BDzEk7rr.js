import{r as i,j as e,H as J}from"./app-B9lfnha4.js";import{A as O}from"./AuthenticatedLayout-UtQUiQ-w.js";import{T as Q,a as X,b as v,M as Z}from"./tabs-5tha8Mtb.js";import{I as ee}from"./popover-BTgurNBe.js";import{B as y}from"./button-DBKSr4MI.js";import{B as se}from"./badge-B1AQ0ii8.js";import{D as ae,b as le,c as re,d as N,S as ne,e as te,f as ie,g as ce,h as u}from"./select-ySBbetOo.js";import{P as oe,a as de,b as o,c as xe,d as k,e as L,f as me}from"./pagination-ClswqU7-.js";import{U as F}from"./UserAvatar-COCHZlMW.js";import{T as S,a as he,b as j,c,d as z,e as r}from"./table-n4pZIN_y.js";import{D as g}from"./download-3CAzVNTx.js";import{C as pe,T as R}from"./use-controlled-state-DT5lt6wS.js";import{S as ue}from"./search-DQfGnZRH.js";import{A as je}from"./award-CpLigNWS.js";import"./ApplicationLogo-zd4BETSS.js";import"./transition-B80scv3U.js";import"./utils-DxrgW60L.js";import"./proxy-CT6J4zB_.js";import"./index-G18pQgYs.js";import"./createLucideIcon-Ddh1YYn5.js";import"./log-out-CrQfjdpH.js";import"./index-BztIbe42.js";import"./floating-ui.utils.dom-Ds-VJJzb.js";import"./check-CVm0OMmE.js";function $e({auth:C}){const x=C?.user?.roles?.some(s=>s.name==="admin")||!1,[I,T]=i.useState([]),[a,m]=i.useState({pageIndex:0,pageSize:10}),[w,P]=i.useState(""),[D,A]=i.useState(""),[d,V]=i.useState("weekly"),[h,E]=i.useState(null),[t,B]=i.useState(1),[b,H]=i.useState(0),[ge,fe]=i.useState({}),[Y,_]=i.useState(!1),f=s=>{window.location.href=route("leaderboard.export",{period:s})},$=s=>{switch(s){case 1:return e.jsx(R,{className:"h-5 w-5 text-yellow-500"});case 2:return e.jsx(Z,{className:"h-5 w-5 text-gray-400"});case 3:return e.jsx(je,{className:"h-5 w-5 text-amber-600"});default:return null}},U=s=>{switch(s){case 1:return"border-l-4 border-yellow-500";case 2:return"border-l-4 border-gray-400";case 3:return"border-l-4 border-amber-500";default:return""}};i.useEffect(()=>{W()},[a.pageIndex,a.pageSize,w,d]);const W=async()=>{_(!0);try{const s=new URLSearchParams({period:d,page:a.pageIndex+1,per_page:a.pageSize,search:w}),l=await(await fetch(`/api/leaderboard/full?${s}`)).json();T(l.data||[]),B(l.last_page||1),H(l.total||0),E(l.user_position)}catch(s){console.error("Error fetching leaderboard data:",s),T([])}finally{_(!1)}},M=()=>{P(D),m(s=>({...s,pageIndex:0}))},K=s=>{s.key==="Enter"&&M()},q=()=>{A(""),P(""),m(s=>({...s,pageIndex:0}))},p=s=>{m(n=>({...n,pageIndex:s-1}))};return e.jsxs(O,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Full Rankings"}),children:[e.jsx(J,{title:"Full Rankings"}),e.jsx("div",{className:"pt-2 pb-8",children:e.jsx("div",{className:"mx-auto max-w-7xl",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs(Q,{value:d,onValueChange:s=>{V(s),m({pageIndex:0,pageSize:10})},children:[e.jsxs(X,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsx(v,{value:"weekly",children:"Weekly"}),e.jsx(v,{value:"monthly",children:"Monthly"}),e.jsx(v,{value:"all_time",children:"All-Time"})]}),e.jsxs("div",{className:"mb-4",children:[d==="weekly"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"This Week"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-MY",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),d==="monthly"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"This Month"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-MY",{month:"long",year:"numeric"})})]}),d==="all_time"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"All-Time Champions"}),e.jsx("p",{className:"text-sm text-gray-600",children:x?"Since the beginning of the competition":"Since November 1, 2025"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full sm:max-w-md",children:[x&&e.jsxs(ae,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(y,{variant:"outline",size:"sm",className:"gap-2 mr-2 flex-shrink-0",children:[e.jsx(g,{className:"h-4 w-4"}),"Export CSV",e.jsx(pe,{className:"h-4 w-4"})]})}),e.jsxs(re,{align:"start",children:[e.jsxs(N,{onClick:()=>f("weekly"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"Weekly (Full List)"]}),e.jsxs(N,{onClick:()=>f("monthly"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"Monthly (Full List)"]}),e.jsxs(N,{onClick:()=>f("all_time"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"All-Time (Full List)"]}),e.jsxs(N,{onClick:()=>f("all"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"All Periods (Full List)"]})]})]}),e.jsx(ee,{placeholder:"Search by name...",value:D,onChange:s=>A(s.target.value),onKeyPress:K,className:"flex-1"}),e.jsxs(y,{onClick:M,className:"bg-black hover:bg-gray-800 text-white flex-shrink-0",children:[e.jsx(ue,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Search"})]}),w&&e.jsxs(y,{onClick:q,variant:"outline",className:"border-gray-300 flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:"Clear"}),e.jsx("span",{className:"sm:hidden",children:"Ã—"})]})]}),e.jsx("div",{className:"flex items-center gap-2 justify-end sm:justify-start",children:e.jsxs(ne,{value:String(a.pageSize),onValueChange:s=>m({pageIndex:0,pageSize:parseInt(s)}),children:[e.jsx(te,{className:"w-[120px]",children:e.jsx(ie,{})}),e.jsxs(ce,{children:[e.jsx(u,{value:"10",children:"10 rows"}),e.jsx(u,{value:"20",children:"20 rows"}),e.jsx(u,{value:"30",children:"30 rows"}),e.jsx(u,{value:"50",children:"50 rows"}),e.jsx(u,{value:"100",children:"100 rows"})]})]})})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx(S,{className:"table-fixed w-full",children:e.jsx(he,{className:"bg-gray-50",children:e.jsxs(j,{children:[e.jsx(c,{className:"w-24 px-6",children:"Rank"}),e.jsx(c,{className:"w-20 px-4",children:"Avatar"}),e.jsx(c,{className:"px-4",children:"Name"}),x&&e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-32 px-4",children:"Matric No"}),e.jsx(c,{className:"w-36 px-4",children:"Phone Number"}),e.jsx(c,{className:"w-24 px-4",children:"Faculty"}),e.jsx(c,{className:"w-20 px-4",children:"Year"})]}),e.jsx(c,{className:"w-36 text-right px-6",children:"Transactions"})]})})}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"600px"},children:e.jsx(S,{className:"table-fixed w-full",children:e.jsx(z,{children:Y?e.jsx(j,{children:e.jsx(r,{colSpan:4,className:"h-24 text-center",children:"Loading..."})}):I.length===0?e.jsx(j,{children:e.jsx(r,{colSpan:4,className:"h-24 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-gray-500",children:[e.jsx(R,{className:"h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No rankings found"})]})})}):I.map((s,n)=>e.jsxs(j,{className:`${U(s.rank)} ${n%2===0?"":"bg-gray-50/50"} hover:bg-gray-100/50 transition-colors`,children:[e.jsx(r,{className:"w-24 font-bold px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[$(s.rank),e.jsxs("span",{className:s.rank<=3?"text-lg":"",children:["#",s.rank]})]})}),e.jsx(r,{className:"w-20 px-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(F,{user:s.user,size:"sm"})})}),e.jsx(r,{className:"font-medium px-4",children:s.user?.name}),x&&e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-32 px-4",children:s.user?.matric_no||"N/A"}),e.jsx(r,{className:"w-36 px-4",children:s.user?.phone_number||"N/A"}),e.jsx(r,{className:"w-24 px-4",children:s.user?.faculty?e.jsx(se,{variant:"outline",children:s.user.faculty.short_name}):e.jsx("span",{className:"text-gray-400",children:"N/A"})}),e.jsx(r,{className:"w-20 px-4",children:s.user?.year_of_study?`Year ${s.user.year_of_study}`:"N/A"})]}),e.jsx(r,{className:`w-36 text-right font-bold px-6 ${s.rank<=3?"text-xl":"text-lg"}`,children:e.jsx("span",{className:s.rank===1?"text-yellow-600":s.rank===2?"text-gray-600":s.rank===3?"text-amber-600":"",children:s.transaction_count})})]},s.user_id))})})}),h&&!x&&e.jsx("div",{className:"bg-gray-100 border-t-2 border-gray-300",children:e.jsx(S,{className:"table-fixed w-full",children:e.jsx(z,{children:e.jsxs(j,{children:[e.jsxs(r,{className:"w-24 font-bold px-6",children:["#",h.rank!==null&&h.rank!==void 0?h.rank:"-"]}),e.jsx(r,{className:"w-20 px-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(F,{user:C.user,size:"sm"})})}),e.jsx(r,{className:"font-bold px-4",children:"You"}),e.jsx(r,{className:"w-36 text-right font-bold text-lg px-6",children:h.transaction_count||0})]})})})})]}),b>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"text-sm text-gray-500 w-full sm:w-auto text-center sm:text-left",children:["Showing ",a.pageIndex*a.pageSize+1," to ",Math.min((a.pageIndex+1)*a.pageSize,b)," of ",b," results"]}),t>1&&e.jsx(oe,{className:"mx-0 w-full sm:w-auto justify-center sm:justify-end",children:e.jsxs(de,{children:[e.jsx(o,{children:e.jsx(xe,{href:"#",onClick:s=>{s.preventDefault(),a.pageIndex>0&&p(a.pageIndex)},className:a.pageIndex===0?"pointer-events-none opacity-50":"cursor-pointer"})}),(()=>{const s=[],n=a.pageIndex+1;t>0&&s.push(e.jsx(o,{children:e.jsx(k,{href:"#",onClick:l=>{l.preventDefault(),p(1)},isActive:n===1,className:"cursor-pointer",children:"1"})},1)),n>3&&s.push(e.jsx(o,{children:e.jsx(L,{})},"ellipsis-1"));for(let l=Math.max(2,n-1);l<=Math.min(t-1,n+1);l++)s.push(e.jsx(o,{children:e.jsx(k,{href:"#",onClick:G=>{G.preventDefault(),p(l)},isActive:n===l,className:"cursor-pointer",children:l})},l));return n<t-2&&s.push(e.jsx(o,{children:e.jsx(L,{})},"ellipsis-2")),t>1&&s.push(e.jsx(o,{children:e.jsx(k,{href:"#",onClick:l=>{l.preventDefault(),p(t)},isActive:n===t,className:"cursor-pointer",children:t})},t)),s})(),e.jsx(o,{children:e.jsx(me,{href:"#",onClick:s=>{s.preventDefault(),a.pageIndex<t-1&&p(a.pageIndex+2)},className:a.pageIndex>=t-1?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]})]})})})})]})}export{$e as default};
