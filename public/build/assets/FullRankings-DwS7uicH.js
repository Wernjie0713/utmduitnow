import{r as t,j as e,H as le}from"./app-qetWhnOG.js";import{A as re}from"./AuthenticatedLayout-YHDnYIvS.js";import{T as ne,a as te,b as y,M as ie}from"./tabs-8KmE8uId.js";import{I as ce}from"./popover-Bnp3oNpM.js";import{B as S}from"./button-Dq77yllh.js";import{B as oe}from"./badge-BFq0aVqz.js";import{S as C,a as I,b as D,c as T,d as r}from"./select-DkVS-V2O.js";import{D as de,b as xe,c as me,d as v}from"./dropdown-menu-Zy0Muw2T.js";import{P as he,a as pe,b as x,c as je,d as P,e as E,f as ue}from"./pagination-CiAMaxve.js";import{U as B}from"./UserAvatar-Of6IaFkl.js";import{T as A,a as ge,b as u,c as d,d as H,e as n}from"./table-CputeLm7.js";import{D as g}from"./download-BT0QpliJ.js";import{C as fe,T as Y}from"./use-controlled-state-AiZYFvZO.js";import{S as Ne}from"./search-Ojkhz5k7.js";import{A as we}from"./award-HuAdYT1K.js";import"./ApplicationLogo-DZ3cp5zd.js";import"./transition-C7jrS6w9.js";import"./utils-DxrgW60L.js";import"./proxy-DOP5oCNK.js";import"./index-VZjm6uBK.js";import"./createLucideIcon-DKCLQZta.js";import"./log-out-CC9EDxz3.js";import"./index-DtzJ2kgm.js";import"./floating-ui.utils.dom-Ds-VJJzb.js";import"./check-BxVQqN8H.js";function Ge({auth:M}){const m=M?.user?.roles?.some(s=>s.name==="admin")||!1,[_,L]=t.useState([]),[a,h]=t.useState({pageIndex:0,pageSize:10}),[b,W]=t.useState(""),[F,z]=t.useState(""),[o,$]=t.useState("weekly"),[f,U]=t.useState("8"),[N,K]=t.useState("12"),[p,q]=t.useState(null),[c,G]=t.useState(1),[k,J]=t.useState(0),[ve,be]=t.useState({}),[O,R]=t.useState(!1),w=s=>{window.location.href=route("leaderboard.export",{period:s})},Q=s=>{switch(s){case 1:return e.jsx(Y,{className:"h-5 w-5 text-yellow-500"});case 2:return e.jsx(ie,{className:"h-5 w-5 text-gray-400"});case 3:return e.jsx(we,{className:"h-5 w-5 text-amber-600"});default:return null}},X=s=>{switch(s){case 1:return"border-l-4 border-yellow-500";case 2:return"border-l-4 border-gray-400";case 3:return"border-l-4 border-amber-500";default:return""}};t.useEffect(()=>{Z()},[a.pageIndex,a.pageSize,b,o,f,N]);const Z=async()=>{R(!0);try{const s=new URLSearchParams({period:o,page:a.pageIndex+1,per_page:a.pageSize,search:b});o==="weekly"&&f?s.append("week",f):o==="monthly"&&N&&(s.append("month",N),s.append("year","2025"));const l=await(await fetch(`/api/leaderboard/full?${s}`)).json();L(l.data||[]),G(l.last_page||1),J(l.total||0),q(l.user_position)}catch(s){console.error("Error fetching leaderboard data:",s),L([])}finally{R(!1)}},V=()=>{W(F),h(s=>({...s,pageIndex:0}))},ee=s=>{s.key==="Enter"&&V()},se=()=>{z(""),W(""),h(s=>({...s,pageIndex:0}))},j=s=>{h(i=>({...i,pageIndex:s-1}))};return e.jsxs(re,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Full Rankings"}),children:[e.jsx(le,{title:"Full Rankings"}),e.jsx("div",{className:"pt-2 pb-8",children:e.jsx("div",{className:"mx-auto max-w-7xl",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs(ne,{value:o,onValueChange:s=>{$(s),h({pageIndex:0,pageSize:10})},children:[e.jsx("div",{className:"mb-6",children:e.jsxs(te,{className:"grid w-full grid-cols-3",children:[e.jsx(y,{value:"weekly",children:"Weekly"}),e.jsx(y,{value:"monthly",children:"Monthly"}),e.jsx(y,{value:"all_time",children:"All-Time"})]})}),e.jsxs("div",{className:"mb-4",children:[o==="weekly"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"This Week"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-MY",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),o==="monthly"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"This Month"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date().toLocaleDateString("en-MY",{month:"long",year:"numeric"})})]}),o==="all_time"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"All-Time Champions"}),e.jsx("p",{className:"text-sm text-gray-600",children:m?"Since the beginning of the competition":"Since November 1, 2025"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full sm:max-w-md",children:[m&&e.jsxs(de,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(S,{variant:"outline",size:"sm",className:"gap-2 mr-2 flex-shrink-0",children:[e.jsx(g,{className:"h-4 w-4"}),"Export CSV",e.jsx(fe,{className:"h-4 w-4"})]})}),e.jsxs(me,{align:"start",children:[e.jsxs(v,{onClick:()=>w("weekly"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"Weekly (Full List)"]}),e.jsxs(v,{onClick:()=>w("monthly"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"Monthly (Full List)"]}),e.jsxs(v,{onClick:()=>w("all_time"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"All-Time (Full List)"]}),e.jsxs(v,{onClick:()=>w("all"),children:[e.jsx(g,{className:"mr-2 h-4 w-4"}),"All Periods (Full List)"]})]})]}),e.jsx(ce,{placeholder:"Search by name...",value:F,onChange:s=>z(s.target.value),onKeyPress:ee,className:"flex-1"}),e.jsxs(S,{onClick:V,className:"bg-black hover:bg-gray-800 text-white flex-shrink-0",children:[e.jsx(Ne,{className:"h-4 w-4 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Search"})]}),b&&e.jsxs(S,{onClick:se,variant:"outline",className:"border-gray-300 flex-shrink-0",children:[e.jsx("span",{className:"hidden sm:inline",children:"Clear"}),e.jsx("span",{className:"sm:hidden",children:"Ã—"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end sm:justify-start",children:[o==="weekly"&&e.jsxs(C,{value:f,onValueChange:U,children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(D,{placeholder:"Select Week"})}),e.jsxs(T,{children:[e.jsx(r,{value:"1",children:"Week 1 (Nov 1-9)"}),e.jsx(r,{value:"2",children:"Week 2 (Nov 10-16)"}),e.jsx(r,{value:"3",children:"Week 3 (Nov 17-23)"}),e.jsx(r,{value:"4",children:"Week 4 (Nov 24-30)"}),e.jsx(r,{value:"5",children:"Week 5 (Dec 1-7)"}),e.jsx(r,{value:"6",children:"Week 6 (Dec 8-14)"}),e.jsx(r,{value:"7",children:"Week 7 (Dec 15-21)"}),e.jsx(r,{value:"8",children:"Week 8 (Dec 22-28)"})]})]}),o==="monthly"&&e.jsxs(C,{value:N,onValueChange:K,children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(D,{placeholder:"Select Month"})}),e.jsxs(T,{children:[e.jsx(r,{value:"11",children:"November 2025"}),e.jsx(r,{value:"12",children:"December 2025"})]})]}),e.jsxs(C,{value:String(a.pageSize),onValueChange:s=>h({pageIndex:0,pageSize:parseInt(s)}),children:[e.jsx(I,{className:"w-[120px]",children:e.jsx(D,{})}),e.jsxs(T,{children:[e.jsx(r,{value:"10",children:"10 rows"}),e.jsx(r,{value:"20",children:"20 rows"}),e.jsx(r,{value:"30",children:"30 rows"}),e.jsx(r,{value:"50",children:"50 rows"}),e.jsx(r,{value:"100",children:"100 rows"})]})]})]})]}),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx(A,{className:"table-fixed w-full",children:e.jsx(ge,{className:"bg-gray-50",children:e.jsxs(u,{children:[e.jsx(d,{className:"w-24 px-6",children:"Rank"}),e.jsx(d,{className:"w-20 px-4",children:"Avatar"}),e.jsx(d,{className:"px-4",children:"Name"}),m&&e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"w-32 px-4",children:"Matric No"}),e.jsx(d,{className:"w-36 px-4",children:"Phone Number"}),e.jsx(d,{className:"w-24 px-4",children:"Faculty"}),e.jsx(d,{className:"w-20 px-4",children:"Year"})]}),e.jsx(d,{className:"w-36 text-right px-6",children:"Transactions"})]})})}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"600px"},children:e.jsx(A,{className:"table-fixed w-full",children:e.jsx(H,{children:O?e.jsx(u,{children:e.jsx(n,{colSpan:4,className:"h-24 text-center",children:"Loading..."})}):_.length===0?e.jsx(u,{children:e.jsx(n,{colSpan:4,className:"h-24 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-gray-500",children:[e.jsx(Y,{className:"h-12 w-12 text-gray-300"}),e.jsx("p",{children:"No rankings found"})]})})}):_.map((s,i)=>e.jsxs(u,{className:`${X(s.rank)} ${i%2===0?"":"bg-gray-50/50"} hover:bg-gray-100/50 transition-colors`,children:[e.jsx(n,{className:"w-24 font-bold px-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[Q(s.rank),e.jsxs("span",{className:s.rank<=3?"text-lg":"",children:["#",s.rank]})]})}),e.jsx(n,{className:"w-20 px-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(B,{user:s.user,size:"sm"})})}),e.jsx(n,{className:"font-medium px-4",children:s.user?.name}),m&&e.jsxs(e.Fragment,{children:[e.jsx(n,{className:"w-32 px-4",children:s.user?.matric_no||"N/A"}),e.jsx(n,{className:"w-36 px-4",children:s.user?.phone_number||"N/A"}),e.jsx(n,{className:"w-24 px-4",children:s.user?.faculty?e.jsx(oe,{variant:"outline",children:s.user.faculty.short_name}):e.jsx("span",{className:"text-gray-400",children:"N/A"})}),e.jsx(n,{className:"w-20 px-4",children:s.user?.year_of_study?`Year ${s.user.year_of_study}`:"N/A"})]}),e.jsx(n,{className:`w-36 text-right font-bold px-6 ${s.rank<=3?"text-xl":"text-lg"}`,children:e.jsx("span",{className:s.rank===1?"text-yellow-600":s.rank===2?"text-gray-600":s.rank===3?"text-amber-600":"",children:s.transaction_count})})]},s.user_id))})})}),p&&!m&&e.jsx("div",{className:"bg-gray-100 border-t-2 border-gray-300",children:e.jsx(A,{className:"table-fixed w-full",children:e.jsx(H,{children:e.jsxs(u,{children:[e.jsxs(n,{className:"w-24 font-bold px-6",children:["#",p.rank!==null&&p.rank!==void 0?p.rank:"-"]}),e.jsx(n,{className:"w-20 px-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(B,{user:M.user,size:"sm"})})}),e.jsx(n,{className:"font-bold px-4",children:"You"}),e.jsx(n,{className:"w-36 text-right font-bold text-lg px-6",children:p.transaction_count||0})]})})})})]}),k>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"text-sm text-gray-500 w-full sm:w-auto text-center sm:text-left",children:["Showing ",a.pageIndex*a.pageSize+1," to ",Math.min((a.pageIndex+1)*a.pageSize,k)," of ",k," results"]}),c>1&&e.jsx(he,{className:"mx-0 w-full sm:w-auto justify-center sm:justify-end",children:e.jsxs(pe,{children:[e.jsx(x,{children:e.jsx(je,{href:"#",onClick:s=>{s.preventDefault(),a.pageIndex>0&&j(a.pageIndex)},className:a.pageIndex===0?"pointer-events-none opacity-50":"cursor-pointer"})}),(()=>{const s=[],i=a.pageIndex+1;c>0&&s.push(e.jsx(x,{children:e.jsx(P,{href:"#",onClick:l=>{l.preventDefault(),j(1)},isActive:i===1,className:"cursor-pointer",children:"1"})},1)),i>3&&s.push(e.jsx(x,{children:e.jsx(E,{})},"ellipsis-1"));for(let l=Math.max(2,i-1);l<=Math.min(c-1,i+1);l++)s.push(e.jsx(x,{children:e.jsx(P,{href:"#",onClick:ae=>{ae.preventDefault(),j(l)},isActive:i===l,className:"cursor-pointer",children:l})},l));return i<c-2&&s.push(e.jsx(x,{children:e.jsx(E,{})},"ellipsis-2")),c>1&&s.push(e.jsx(x,{children:e.jsx(P,{href:"#",onClick:l=>{l.preventDefault(),j(c)},isActive:i===c,className:"cursor-pointer",children:c})},c)),s})(),e.jsx(x,{children:e.jsx(ue,{href:"#",onClick:s=>{s.preventDefault(),a.pageIndex<c-1&&j(a.pageIndex+2)},className:a.pageIndex>=c-1?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]})]})})})})]})}export{Ge as default};
